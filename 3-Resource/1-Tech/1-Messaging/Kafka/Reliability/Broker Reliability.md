카프카의 신뢰성은 브로커 설정을 통해
클러스터 전체 혹은 토픽 단위로 조절할 수 있다.

---

### 복제 팩터 (Replication Factor)

복제 팩터는 하나의 토픽을 몇 개의 브로커에 복제할지를 의미한다.

- 토픽 설정: replication.factor
- 브로커 기본값: default.replication.factor

복제 팩터가 N이면 N-1개의 브로커가 중단되어도
토픽의 데이터를 읽고 쓸 수 있다.

---

### 복제 팩터 결정 시 고려 사항

- 가용성  
  레플리카 수가 많을수록 장애 허용도가 높아진다.

- 지속성  
  디스크 장애 시 데이터 유실 확률이 낮아진다.

- 처리량  
  레플리카 수가 늘어날수록 브로커 간 네트워크 트래픽이 증가한다.

- 종단 지연  
  모든 ISR에 복제가 완료되어야 컨슈머가 읽을 수 있다.

- 비용  
  디스크와 네트워크 비용이 레플리카 수만큼 증가한다.

---

### 랙 인식 복제

broker.rack 설정을 통해
레플리카를 서로 다른 랙에 분산시킬 수 있다.

모든 레플리카가 동일한 랙에 있을 경우
랙 스위치 장애로 파티션 전체가 불능 상태가 될 수 있다.

---

### 언클린 리더 선출

unclean.leader.election.enable (default: false)

리더가 불능일 때 ISR 중 리더를 선출하면 클린 리더 선출이다.
하지만 ISR이 없는 경우 두 가지 선택지가 있다.

- 아웃-오브-싱크 레플리카를 리더로 승격하지 않는다  
  → 파티션은 오프라인 상태 유지

- 아웃-오브-싱크 레플리카를 리더로 승격한다  
  → 일부 메시지 유실, 컨슈머 일관성 붕괴

---

### ISR 유지 관련 설정

- zookeeper.session.timeout.ms  
  브로커가 주키퍼와 세션을 유지할 수 있는 최대 시간

- replica.lag.time.max.ms  
  리더의 최신 메시지를 따라잡지 못할 수 있는 최대 시간

---

### 디스크 플러시

카프카는 항상 디스크에 즉시 쓰지 않는다.
대부분의 경우 OS의 페이지 캐시에 의존한다.

- flush.messages  
  디스크에 쓰지 않은 최대 메시지 수

- flush.ms  
  디스크 플러시 주기
