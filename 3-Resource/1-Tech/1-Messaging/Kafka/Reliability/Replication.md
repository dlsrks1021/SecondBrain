카프카의 신뢰성 보장의 핵심은 **복제(replication)** 메커니즘이다.

카프카는 파티션마다 여러 개의 레플리카를 유지하며,
그중 하나를 리더 레플리카로 지정한다.

모든 메시지는 리더 레플리카에 먼저 쓰여지고,
팔로워 레플리카들은 리더로부터 메시지를 복제한다.

---

### 인-싱크 레플리카(ISR)

다음 조건을 만족하는 레플리카만 인-싱크 레플리카로 간주된다.

- 컨트롤러와 활성 세션을 유지하고 있다.
- 최근 리더로부터 메시지를 읽어왔다.
- 읽어온 메시지가 리더의 최신 메시지를 따라잡고 있다.

조건을 만족하지 못한 레플리카는 아웃-오브-싱크 상태가 된다.

---

### ISR과 성능 트레이드오프

모든 인-싱크 레플리카가 메시지를 받을 때까지
프로듀서와 컨슈머는 커밋을 기다려야 한다.

따라서 ISR 동기화가 느려지면 다음 문제가 발생한다.

- 프로듀서 응답 지연
- 컨슈머 읽기 지연
- 전체 시스템 처리량 저하

ISR은 신뢰성과 성능 사이의 균형점이다.
