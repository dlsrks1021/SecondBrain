
컨슈머 그룹은 카프카 컨슈머의
확장성과 장애 복구를 담당하는 핵심 개념이다.

같은 그룹에 속한 컨슈머들은
토픽의 파티션을 나누어 처리한다.

---

## 파티션과 컨슈머의 관계

카프카는 다음 규칙을 강제한다.

- 하나의 파티션은 하나의 컨슈머만 읽는다
- 하나의 컨슈머는 여러 파티션을 읽을 수 있다

이는 **파티션 단위 순서 보장**을 위한 설계다.

---

## 컨슈머 수와 처리량

- Consumer < Partition  
  → 일부 컨슈머가 여러 파티션 처리

- Consumer = Partition  
  → 이상적인 병렬 처리

- Consumer > Partition  
  → 초과 컨슈머는 Idle 상태

확장 한계는 파티션 수로 결정된다.

---

## Group Coordinator

각 컨슈머 그룹에는
그룹 코디네이터 역할을 수행하는 **카프카 브로커**가 존재한다.

그룹 코디네이터의 역할:
- 컨슈머 그룹 멤버십 관리
- Heartbeat 수신
- Offset Commit 관리
- Rebalance 트리거 및 조율

컨슈머는 poll() 과정에서
그룹 코디네이터와 지속적으로 통신한다.

---

## 정적 그룹 멤버십 (Static Membership)

기본적으로 컨슈머 그룹 멤버십은 **동적**이다.

컨슈머가 종료되면:
- 파티션 해제
- 리밸런스 발생
- 재참여 시 새로운 member.id 발급

### group.instance.id 설정

group.instance.id를 설정하면
컨슈머는 **정적 그룹 멤버**가 된다.

- 컨슈머가 일시 중단되어도
  session.timeout.ms 동안 그룹 유지
- 재시작 시 리밸런스 없이
  기존 파티션 재할당 가능

대규모 컨슈머 그룹에서
불필요한 리밸런스를 줄이는 데 효과적이다.
